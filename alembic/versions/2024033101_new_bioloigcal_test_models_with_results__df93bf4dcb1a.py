"""new bioloigcal test models, with results in each individual table

Revision ID: df93bf4dcb1a
Revises: 5fe2ff8986d7
Create Date: 2024-03-31 23:01:09.191545

"""

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = "df93bf4dcb1a"
down_revision = "5fe2ff8986d7"
branch_labels = None
depends_on = None

new_test_type = sa.Enum(
    "DNA_M_PHENO_AGE_LEVINE_TEST", "BLOODMARKER_BA_ESTIMATION_TEST", name="testtype"
)


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "bloodmarker_ba_estimation_test",
        sa.Column("id", sa.UUID(as_uuid=False), nullable=False),
        sa.Column("birthday", sa.Date(), nullable=False),
        sa.Column("sex", sa.String(length=1), nullable=False),
        sa.Column("albumin", sa.Float(), nullable=True),
        sa.Column("alkaline_phosphatase", sa.Float(), nullable=True),
        sa.Column("urea", sa.Float(), nullable=True),
        sa.Column("cholesterol", sa.Float(), nullable=True),
        sa.Column("creatinine", sa.Float(), nullable=True),
        sa.Column("cystatin_c", sa.Float(), nullable=True),
        sa.Column("glycated_haemoglobin", sa.Float(), nullable=True),
        sa.Column("log_c_reactive_protein", sa.Float(), nullable=True),
        sa.Column("log_gamma_glutamyltransf", sa.Float(), nullable=True),
        sa.Column("red_blood_cell_erythrocyte_count", sa.Float(), nullable=True),
        sa.Column("mean_corpuscular_volume", sa.Float(), nullable=True),
        sa.Column(
            "red_blood_cell_erythrocyte_distribution_width", sa.Float(), nullable=True
        ),
        sa.Column("monocyte_count", sa.Float(), nullable=True),
        sa.Column("neutrophill_count", sa.Float(), nullable=True),
        sa.Column("lymphocyte_percentage", sa.Float(), nullable=True),
        sa.Column("mean_sphered_cell_volume", sa.Float(), nullable=True),
        sa.Column("log_alanine_aminotransfe", sa.Float(), nullable=True),
        sa.Column("log_shbg", sa.Float(), nullable=True),
        sa.Column("log_vitamin_d", sa.Float(), nullable=True),
        sa.Column(
            "high_light_scatter_reticulocyte_percentage", sa.Float(), nullable=True
        ),
        sa.Column("glucose", sa.Float(), nullable=True),
        sa.Column("platelet_distribution_width", sa.Float(), nullable=True),
        sa.Column("mean_corpuscular_haemoglobin", sa.Float(), nullable=True),
        sa.Column("platelet_crit", sa.Float(), nullable=True),
        sa.Column("apolipoprotein_a", sa.Float(), nullable=True),
        sa.Column("result", sa.Float(), nullable=True),
        sa.ForeignKeyConstraint(
            ["id"],
            ["biological_test.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "dna_m_pheno_age_levine_2018_test",
        sa.Column("id", sa.UUID(as_uuid=False), nullable=False),
        sa.Column("birthday", sa.Date(), nullable=False),
        sa.Column("sex", sa.String(length=1), nullable=False),
        sa.Column("albumin", sa.Float(), nullable=True),
        sa.Column("creatinine", sa.Float(), nullable=True),
        sa.Column("glucose", sa.Float(), nullable=True),
        sa.Column("c_reactive_protein", sa.Float(), nullable=True),
        sa.Column("lymphocytes_percentage", sa.Float(), nullable=True),
        sa.Column("mean_corpuscular_volume", sa.Float(), nullable=True),
        sa.Column("red_blood_cell_distribution_width", sa.Float(), nullable=True),
        sa.Column("alkaline_phosphatase", sa.Float(), nullable=True),
        sa.Column("white_blood_cell_count", sa.Float(), nullable=True),
        sa.Column("result", sa.Float(), nullable=True),
        sa.ForeignKeyConstraint(
            ["id"],
            ["biological_test.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.drop_table("blood_test")
    op.drop_table("dna_test")

    op.execute("ALTER TABLE biological_test ALTER COLUMN test_type TYPE VARCHAR(255)")

    op.execute("DROP TYPE IF EXISTS testtype")

    op.execute(
        "CREATE TYPE testtype AS ENUM ('DNA_M_PHENO_AGE_LEVINE_TEST', 'BLOODMARKER_BA_ESTIMATION_TEST')"
    )

    op.execute(
        "UPDATE biological_test SET test_type = 'DNA_M_PHENO_AGE_LEVINE_TEST' WHERE test_type = 'DNA_TEST'"
    )
    op.execute(
        "UPDATE biological_test SET test_type = 'BLOODMARKER_BA_ESTIMATION_TEST' WHERE test_type = 'BLOOD_TEST'"
    )

    op.execute(
        "ALTER TABLE biological_test ALTER COLUMN test_type TYPE testtype USING (test_type::testtype)"
    )
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###

    op.execute("ALTER TABLE biological_test ALTER COLUMN test_type TYPE VARCHAR(255)")

    op.execute(
        "UPDATE biological_test SET test_type = 'DNA_TEST' WHERE test_type = 'DNA_M_PHENO_AGE_LEVINE_TEST'"
    )
    op.execute(
        "UPDATE biological_test SET test_type = 'BLOOD_TEST' WHERE test_type = 'BLOODMARKER_BA_ESTIMATION_TEST'"
    )

    op.execute("DROP TYPE IF EXISTS testtype")

    op.execute("CREATE TYPE testtype AS ENUM ('BLOOD_TEST', 'DNA_TEST')")

    op.execute(
        "ALTER TABLE biological_test ALTER COLUMN test_type TYPE testtype USING (test_type::testtype)"
    )
    op.create_table(
        "dna_test",
        sa.Column("id", sa.UUID(), autoincrement=False, nullable=False),
        sa.Column("gene1", sa.VARCHAR(length=50), autoincrement=False, nullable=True),
        sa.Column("gene2", sa.VARCHAR(length=50), autoincrement=False, nullable=True),
        sa.ForeignKeyConstraint(
            ["id"], ["biological_test.id"], name="dna_test_id_fkey"
        ),
        sa.PrimaryKeyConstraint("id", name="dna_test_pkey"),
    )
    op.create_table(
        "blood_test",
        sa.Column("id", sa.UUID(), autoincrement=False, nullable=False),
        sa.Column(
            "glucose",
            sa.DOUBLE_PRECISION(precision=53),
            autoincrement=False,
            nullable=True,
        ),
        sa.Column(
            "cholesterol",
            sa.DOUBLE_PRECISION(precision=53),
            autoincrement=False,
            nullable=True,
        ),
        sa.ForeignKeyConstraint(
            ["id"], ["biological_test.id"], name="blood_test_id_fkey"
        ),
        sa.PrimaryKeyConstraint("id", name="blood_test_pkey"),
    )
    op.drop_table("dna_m_pheno_age_levine_2018_test")
    op.drop_table("bloodmarker_ba_estimation_test")
    # ### end Alembic commands ###
